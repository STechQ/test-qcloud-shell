!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.flowcomponent=t():e.flowcomponent=t()}(this,(()=>(()=>{"use strict";var __webpack_modules__={63211:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{P:()=>UidHelper});const characters="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",charLength=characters.length,processStartTime=Date.now()-performance.now(),isomorphicCrypto="undefined"!=typeof crypto?eval("crypto"):eval("require")("crypto");class UidHelper{static createFastUID(){return Date.now().toString(36).substring(0,9)+Math.random().toString(36).substring(2,13)}static createSecureUID(){const e=(performance.now()+processStartTime).toString(36).replace(".","");let t="";const s=isomorphicCrypto.getRandomValues(new Uint8Array(6));for(let e=0;e<6;e++)t+=characters[s[e]%charLength];return e+t}static createUUID(){return isomorphicCrypto.randomUUID()}}}},__webpack_module_cache__={};function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var s=__webpack_module_cache__[e]={exports:{}};return __webpack_modules__[e](s,s.exports,__webpack_require__),s.exports}__webpack_require__.d=(e,t)=>{for(var s in t)__webpack_require__.o(t,s)&&!__webpack_require__.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},__webpack_require__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),__webpack_require__.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var __webpack_exports__={};return(()=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>h});class e extends Error{get detail(){return this._detail}constructor(t){super(t.message),this.name=e.FlowErrorName,t.stack&&(this.stack=t.stack),this.type=t.type,this.code=t.code,this.summary=t.summary,this.parameters=t.parameters,this.category=t.category,this._detail=t.detail}static isFlowError(t){return t instanceof e||t.name==e.FlowErrorName}appendDetail(e){this._detail=this._detail?this._detail+" - "+e:e}}e.FlowErrorName="FlowRuntimeError_ae24";const t={start:"Ä°ÅŸlem BaÅŸlatÄ±ldÄ±",complete:"GÃ¶rev TamamlandÄ±",cancel:"Ä°ptal Edildi",return:"Ä°ade Edildi",finish:"SÃ¼reÃ§ TamamlandÄ±",update:"GÃ¼ncellendi",assignToUser:"KullanÄ±cÄ±ya Atama",assignToUnit:"Birime Atama",assignToSwimlane:"Havuza Atama",save:"Kaydedildi",addNote:"Not Eklendi",updateNote:"Not GÃ¼ncellendi",deleteNote:"Not Silindi",function:"Fonksiyon Ã‡alÄ±ÅŸtÄ±rÄ±ldÄ±",fileUpload:"Dosya YÃ¼klendi",fileDownload:"Dosya Ä°ndirildi",fileDelete:"Dosya Silindi",statusChanged:"Durum DeÄŸiÅŸti",threadRetried:"Tekrar Denendi"},s={start:"Process Started",complete:"Task Completed",cancel:"Cancelled",return:"Rejected",finish:"Process Finished",update:"Updated",assignToUser:"User Assignement",assignToUnit:"Unit Assignment",assignToSwimlane:"Swimlane Assignment",save:"Saved",addNote:"Note Added",updateNote:"Note Updated",deleteNote:"Note Deleted",function:"Function Run",fileUpload:"File Uploaded",fileDownload:"File Downloaded",fileDelete:"File Deleted",statusChanged:"Status Changed",threadRetried:"Retried"};class r{static getDescription(e,r){let a=e||"";return a="tr_TR"===r?Object.keys(t).includes(e)?t[e]:a:Object.keys(s).includes(e)?s[e]:a,a}}let a;a={getUser:{name:"getUser",type:"flow"},notify:{name:"notify",type:"flow"},userTaskActivity:{name:"userTaskActivity",type:"flow"},preForm:{name:"TaskPreview",type:"qjson"}},a={iPaasEndPoint:{name:"IPaaS_Endpoint",type:"constant"}};const n={"":"Custom","Pending-InProgress":"Pending-InProgress","Pending-Approval":"Pending-Approval","Resolved-Completed":"Resolved-Completed",New:"New",Returned:"Returned","Returned-Originator":"Returned-Originator","Returned-Recipient":"Returned-Recipient","Resolved-Cancelled":"Resolved-Cancelled"},o={"":"StatÃ¼ Yok","Pending-InProgress":"Ä°ÅŸlemde","Pending-Approval":"Bekliyor-Onay","Resolved-Completed":"TamamlandÄ±",New:"Yeni",Returned:"Ä°ade","Returned-Originator":"GiriÅŸÃ§iye Ä°ade Edildi","Returned-Recipient":"Ã‡alÄ±ÅŸana Ä°ade Edildi","Resolved-Cancelled":"Ä°ptal Edildi"};class i{static getDescription(e,t){return("tr_TR"==t?o:n)[e]||e||""}}class c extends Error{constructor(e){super(e.message),this.name=c.CustomErrorName,e.stack&&(this.stack=e.stack),this.type=e.type,this.code=e.code,this.summary=e.summary,this.parameters=e.parameters,this.category=e.category,this.detail=e.detail,this.statusCode=e.statusCode}toJSON(){const e={statusCode:this.statusCode,type:this.type,category:this.category,code:this.code,summary:this.summary,parameters:this.parameters,detail:this.detail,stack:this.stack,message:this.message,additionals:this.additionals};return JSON.stringify(e)}getAdditionalSetter(){return(e,t)=>{this.additionals=this.additionals||{},this.additionals[e]=t}}}c.CustomErrorName="CustomError_WF_ae24";const d="WM-2730",l={messages:{startWasNotOnUs:e=>`process ${e} start was not on us. ðŸ˜¢`,wfeWasNotOnUs:({prefix:e,suffix:t})=>`${e?e+" ":""}workflow engine was not on us. ðŸ˜¢${t?" "+t:""}`,workflowEngineWasOnUs:({prefix:e,suffix:t})=>`${e?e+" ":""}workflow engine was on us. ðŸ¤”${t?" "+t:""}`},errors:{di404:(e,t)=>new c({statusCode:404,message:`dataInstance ${t?"history":""} for piid: ${e} can not be found`,category:"error",code:"WFE-235",type:"technical"}),taskId404:e=>new c({statusCode:404,message:`taskId: ${e} can not be found`,category:"error",code:"WFE-232",type:"technical"}),piid404:e=>new c({statusCode:404,message:`piid: ${e} can not be found`,category:"error",code:"WFE-234",type:"technical"}),ctxErr:e=>new Error(`execution context is missing: ${e}`),ctxOnUsErr:e=>new Error(`wfEngineOnUs is missing: ${e}`)},wfeStepNames:{humanTask:"humantask"},calculations:{collectionName:(e,t)=>e+"_"+t,isSystemStep:e=>l.wfeStepNames.humanTask==e}};class u{static formatDate(e,t){"string"==typeof e&&(e=new Date(e));let s={},r="tr-TR";return t.date&&(r=t.date.locale||r,s={...s,year:"numeric",month:"2-digit",day:"2-digit"}),t.time&&(s.hour=s.minute="2-digit",0!=t.time.second&&(s.second="2-digit")),new Intl.DateTimeFormat(r,s).format(e)}static toLocaleIsoString(e){return e=e||new Date,new Date(e.getTime()-6e4*e.getTimezoneOffset()).toISOString()}static toDefaultTimeStampString(e){if(!e)return;const t=e.getFullYear(),s=(e.getMonth()+1).toString().padStart(2,"0"),r=e.getDate().toString().padStart(2,"0"),a=e.getHours().toString().padStart(2,"0"),n=e.getMinutes().toString().padStart(2,"0"),o=e.getSeconds().toString().padStart(2,"0"),i=e.getMilliseconds().toString().padStart(3,"0"),c=e.getTimezoneOffset(),d=Math.floor(Math.abs(c)/60),l=Math.abs(c)%60;return`${t}/${s}/${r} ${a}:${n}:${o}:${i}${(c>0?"-":"+")+String(d).padStart(2,"0")+String(l).padStart(2,"0")}`}static fromDefaultTimeStampString(e){if(!e)return;const t=e.match(/^(\d{4})\/(\d{2})\/(\d{2}) (\d{2}):(\d{2}):(\d{2}):(\d{3})([+-])(\d{2})(\d{2})$/);if(!t)throw new Error("unexpected DefaultTimeStampString format: "+e);const[,s,r,a,n,o,i,c,d,l,u]=t,p=new Date(Date.UTC(parseInt(s),parseInt(r)-1,parseInt(a),parseInt(n),parseInt(o),parseInt(i),parseInt(c))),w=(60*parseInt(l)+parseInt(u))*("+"===d?1:-1);return p.setMinutes(p.getMinutes()-w),p}static toUTCDate(e){return e=e||new Date,new Date(Date.UTC(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds(),e.getUTCMilliseconds()))}}var p,w=__webpack_require__(63211);function m(e,t){switch(e){case"'":case'"':return[e,t+1];default:return[void 0,t]}}function f(e,t){if(null!=e)return e[t]}function _(e,t){let s=t;const r=e.length;let a,n="",o=!1;for(var i=0;i<r;i++){let t=e[i];if(o)a==t||"]"==t&&!a?(a&&i++,s=f(s,n),n="",o=!1):n+=t;else switch(t){case".":n&&(s=f(s,n)),n="";break;case"[":n&&(s=f(s,n)),n="",[a,i]=m(e[i+1],i),o=!0;break;default:n+=t}}return n&&(s=f(s,n)),s}p={boolean:!0,datetime:!0,enum:!0,number:!0,dataType:!0,string:!0,constant:!0,any:!0},Object.keys(p);const g=function(e){return e.client?"client":e.server?"server":e.wfe?"wfe":"workflow"},y=function(e,t,s){switch(null==e?void 0:e.type){case"boolean":return"true"==e.value;case"input":return _(e.value,t.input);case"context":if(s.wfe)return _(e.value,s.wfe.wffContext());if(s.workflow)return _(e.value,s.workflow.context());throw new Error("can not retrieve from Context in "+g(s)+". You can only retrieve Context in workflow.");case"vars":return _(e.value,t.vars);case"output":return _(e.value,t.output);case"constant":if(s.wfe){const t=s.wfe.getConstant(e.value);if(t instanceof Promise)throw new Error("can not retrieve from Constants with async getConstant in "+g(s));return _(e.value,t)}if(s.workflow)return _(e.value,s.workflow.constantsWId);throw new Error("can not retrieve from Constants in "+g(s)+". You can only retrieve Constants in workflow.");case"number":return Number(e.value);case"string":case"enum":return e.value;case"literal":return function(e,t,s){if(""==e)return"";const r=Object.create(null),{input:a,vars:n,output:o}=t,i=function(e){const{workflow:t,client:s,server:r,wfe:a}=e;if(t)return{type:"workflow",...t.context()||{action:void 0},constants:t.constantsWId};if(s)return{type:"client"};if(r)return{type:"server"};if(a){const e=a.wfExecutionContext(),{wfEngineOnUs:t,user:s}=e.getWfeOnUs(),{processInstance:r,dataInstance:n,lastAction:o}=t;return{type:"workflowEngine",processInstance:r,dataInstance:n,action:o,currentUser:s}}throw new Error("WTF: where are you executing this flow ???")}(s),c={input:a,vars:n,output:o,context:i},d=new Function("window","global","globalThis","flow","document","XMLHttpRequest","fetch","setInterval","navigator",`return \`${e}\`;`).apply(r,[r,r,r,c,void 0,void 0,void 0,void 0,void 0]);return"null"===d?null:d}(e.value,t,s);case"notSet":return}},h=async t=>{var s;const a=t.flow.getWFE();if(!a)throw new Error("start step can only be used for workflow flow environment");const n=a.wfExecutionContext(),o=n.getScopeStore(),{wfEngineOnUs:p,userId:m,workflowModel:f,user:_,appId:g}=n.getWfeOnUs(),{processInstance:h,dataInstance:k,wfInput:I}=n.getWfeOnUsProcessInstance(),{dsManager:v,taskId:T}=o;if(!v)throw l.errors.ctxErr("dsManager");const{trxQueue:S,stepStates:U}=p;if(!S)throw l.errors.ctxOnUsErr("trxQueue");const{processId:b,processInstanceId:D,businessKey:E}=h,C=Date.now();if(T){const s=await v.Get("WFE_Task",{taskId:T});if(!s)throw new Error(`task not found: ${T}`);if(s.stepId!=t.entryInfo.stepID)throw new Error(`DB task stepID: ${s.stepId} model task stepID: ${t.entryInfo.stepID} mismatch.`);const n=p.lastAction;if(!n)throw new Error("no action to complete human task");switch(null==n?void 0:n.actionType){case"cancel":case"complete":case"return":break;default:throw new Error(`unexpected actionType: ${n.actionType} customType: ${n.customType}`)}const i=t.props.actions.find((e=>e.actionType==n.actionType&&e.customType==n.customType));if(!i)throw new Error("task did not have action: {type: "+n.actionType+", custom: "+n.customType+"}");const c=await v.List("WFE_Activity",{processInstanceId:D}),d=a.converters.convertToIActivities(c);if(!h.tasks.find((e=>e.taskId==s.taskId)))throw new Error("unexpected task not found error");const l=await a.authz.canUserPerformActionOnTask(_,s,i,d,h);if("success"!=l.type)return void t.flow.cancel(new e({message:l.message,category:"error",code:l.code,type:"business"}));await a.events.preUserTaskComplete(s,i,h,k);const w=n.actionType,f=r.getDescription(n.actionType,"tr_TR");h.lastUpdate=u.toDefaultTimeStampString(new Date(C)),h.lastUpdateUser=_,h.lastUpdateDescriptionCode=w,h.lastUpdateDescription=f,await v.Delete("WFE_Task",{taskId:T},{trxQueue:S}),await v.Update("WFE_ProcessInst",{processInstanceId:D},{updatedAt:C,lastUpdateUser:_,lastUpdateDescriptionCode:w,lastUpdateDescription:f,dataInstance:k},{trxQueue:S}),delete s.flowThreadId;const g={...s,status:"completed",performerUserId:m,action:n,updatedAt:void 0,endDate:C};await v.Insert("WFE_TaskHistory",g,{trxQueue:S}),h.tasks=h.tasks.filter((e=>e.taskId!=s.taskId)),o.taskId=void 0,await a.events.userTaskCompleted(g,i,h,k,t.props.sla),t.flow.next()}else{const e=p.lastAction,r=w.P.createSecureUID()+"-"+b,n=t.entryInfo.inputName,l={processId:b,processInstanceId:D,startDate:C,stepId:t.entryInfo.stepID,stepInputName:n,taskId:r,updatedAt:C,businessKey:E,flowThreadId:t.entryInfo.flowThreadId,customStatus:t.props.taskStatus||t.props.procesStatus||h.status,taskLabel:t.props.label};switch(t.props.sendTo||(t.props.user?t.props.sendTo="user":t.props.swimlane&&(t.props.sendTo="swimlane")),t.props.sendTo){case"user":const e=t.flow.evalGet({type:"literal",value:t.props.user||""},y);if(!e)throw new c({message:`Target UserId Not Found PID: ${b} TID: ${r} targetUser: ${e}`,statusCode:404,code:d,category:"error",type:"technical"});const s=await a.system.resolveUser(e);if(!s)throw new c({message:`Target User Not Found PID: ${b} TID: ${r} targetUser: ${e}`,statusCode:404,code:d,category:"error",type:"technical"});l.userId=e,l.userName=s.fullName;break;case"swimlane":l.swimlane=await a.system.resolveSwimlane(t.props.swimlane)}if(t.props.sla&&t.props.sla.selectedSlaModelId){const e=await a.system.createSLA(null===(s=t.props.sla)||void 0===s?void 0:s.selectedSlaModelId);l.sla=e.sla,l.priority=e.priority}await v.Insert("WFE_Task",l,{trxQueue:S});const u=await a.converters.convertToITask(l,f),m=h.status;h.tasks.push(u),h.status=t.props.procesStatus||h.status,h.statusDescription=i.getDescription(t.props.procesStatus,"tr_TR"),o.taskId=u.taskId,await a.events.userTaskCreated(l,h,k,e,m!=h.status?{oldStatus:m}:void 0,t.props.sla);const _=a.converters.convertFromIProcessInstAndIDataInst(h,k,{stepStates:U,wfInput:I});await v.Update("WFE_ProcessInst",{processInstanceId:D},_,{trxQueue:S}),a.system.gracefulEnd(),t.flow.pause()}}})(),__webpack_exports__})()));