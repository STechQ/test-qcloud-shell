!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.flowcomponent=t():e.flowcomponent=t()}(this,(()=>(()=>{"use strict";var e={d:(t,r)=>{for(var o in r)e.o(r,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:r[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};function r(e,t){switch(e){case"'":case'"':return[e,t+1];default:return[void 0,t]}}function o(e,t,r){if("other"==r.type){if("object"!=typeof e)return;return e[t]=r.value}let o=e[t];return void 0!==o?o:e[t]="array"==r.type?[]:{}}function n(e,t){switch(e[t]){case'"':case"'":return"object";default:return"array"}}e.r(t),e.d(t,{default:()=>l});const s=function(e,t,s){switch(e.type){case"vars":case"output":if(s.msg.output=s.msg.output||{},e.value){const a="vars"==e.type?s.msg.vars:s.msg.output;!function(e,t,s){let a=s;const u=e.length;let i,c="",l=!1;for(var p=0;p<u;p++){let s=e[p];if(l)if(i==s||"]"==s&&!i){let r;switch(i&&p++,e[p+1]){case"[":r={type:n(e,p+2)};break;case".":r={type:"object"};break;case void 0:r={type:"other",value:t};break;default:throw new Error("unexpected set msg")}a=o(a,c,r),c="",l=!1}else c+=s;else switch(s){case".":c&&(a=o(a,c,{type:"object"})),c="";break;case"[":c&&(a=o(a,c,{type:n(e,p+1)})),c="",[i,p]=r(e[p+1],p),l=!0;break;default:c+=s}}c&&(a=o(a,c,{type:"other",value:t}))}(e.value,t,a)}else Object.keys(t).forEach((e=>s.msg.output[e]=t[e]));break;case"wholeVars":Object.keys(t).forEach((e=>s.msg.vars[e]=t[e]))}};function a(e,t){switch(e){case"'":case'"':return[e,t+1];default:return[void 0,t]}}function u(e,t){if(null!=e)return e[t]}function i(e,t){let r=t;const o=e.length;let n,s="",i=!1;for(var c=0;c<o;c++){let t=e[c];if(i)n==t||"]"==t&&!n?(n&&c++,r=u(r,s),s="",i=!1):s+=t;else switch(t){case".":s&&(r=u(r,s)),s="";break;case"[":s&&(r=u(r,s)),s="",[n,c]=a(e[c+1],c),i=!0;break;default:s+=t}}return s&&(r=u(r,s)),r}const c=function(e,t){switch(e.type){case"boolean":return"true"==e.value;case"input":return i(e.value,t.msg.input);case"vars":case"output":return i(e.value,t.msg.vars);case"number":return Number(e.value);case"string":case"enum":return e.value;case"literal":return function(e,t){const r=t,o=Object.create(null),n=Object.keys(t),s=n.map((e=>r[e]?r[e]:void 0));let a=`return \`${e}\`;`;return new Function("window","global","globalThis",...n,"document","XMLHttpRequest","fetch","setInterval","navigator",a).apply(o,[o,o,o,...s,void 0,void 0,void 0,void 0,void 0])}(e.value,t.msg);case"wholeMsg":return t.msg;case"wholeVars":return t.msg.vars;case"notSet":return}},l=async e=>{const t=e.flow.getWorkflow(),r=null==t?void 0:t.server;if(!r)throw new Error("serviceCall can not execute on environments without workflow server");const o=await e.model.retriever(`${e.props.id}?version=${e.props.version}`);if("restService"!=o.type)throw new Error("this is not a rest service");const n=function(e,t,r){var o;let n={};return null===(o=e.inVariables)||void 0===o||o.some((e=>{if(!t.find((t=>t.variable===e._name)))throw new Error(`input mapping error.'${e._name}' not found in given mapping.`)})),t.forEach((e=>{n[e.variable]=r(e.mapping,c)})),n}(o,e.props.inParamMapping,e.flow.evalGet),a=await async function(e,t,r,o){var n;const a={msg:{input:r,vars:{},output:void 0}};let u;if(null==o?void 0:o.httpMethod){if(!t.httpMethod.some((e=>e==o.httpMethod)))throw new Error("HttpMethod not found!!!");u=o.httpMethod}else u=t.httpMethod[0];let i=await e.urlGetter(t.hostKey);const l=t.requestUrl;l&&(null==l?void 0:l.length)>0&&(i=function(e,t,r){return t=t.endsWith("/")?t.slice(0,-1):t,t=r.filter((e=>"PATH"==e.type)).reduce(((t,r)=>`${t}/${c(r.value,e)}`),t),r.filter((e=>"QUERY"==e.type)).reduce(((t,r,o)=>{if("QUERY"!=r.type)return t;const n=c(r.key,e),s=c(r.value,e);return 0==o?`${t}?${n}=${s}`:`${t}&${n}=${s}`}),t)}(a,i,l));const p=t.requestBody;let f;p&&(f={},p.forEach((e=>{if(""==e.targetKey){const t=c(e.src,a);"object"==typeof t&&(f={...f,...t})}else f[e.targetKey]=c(e.src,a)})));const d=t.requestHeader;let v;d&&(v=Object.keys(d).reduce(((e,t)=>{const r=c(d[t],a);return void 0===r||(e[t]=r.toString()),e}),{}));let h=t.mock?t.mock.find((e=>{try{return RegExp(e.reqExp).exec(i)}catch(e){return}})):void 0;const y=h?{data:h.respBody,status:h.respStatus,headers:h.respHeaders}:await e.request({method:u,url:i,headers:v,body:f});return t.responseStatus&&s(t.responseStatus,y.status,a),t.responseHeader&&Object.entries(t.responseHeader).forEach((([e,t])=>{var r;return s(t,null===(r=y.headers)||void 0===r?void 0:r[e],a)})),null===(n=t.responseBody)||void 0===n||n.forEach((e=>s(e.target,function(e,t){if(!t)return e;const r=t.split(".");let o=e;for(const e of r)if(o.hasOwnProperty(e))o=o[e];else{if(!/\[(\d+)\]/.test(e))return;{const t=e.match(/\[(\d+)\]/);if(!t)return;const r=parseInt(t[1]);if(o=o[e.slice(0,e.length-t[0].length)],!Array.isArray(o))return;o=o[r]}}return o}(y.data,e.srcKey),a))),a.msg.output}(r,o,n,{httpMethod:e.props.httpMethod});!function(e,t,r){const o=Object.keys(e);t.forEach((t=>{if(!o.some((e=>e==t.variable)))throw new Error(`output mapping error.'${t.variable}' not found in response. `);r(t.mapping,e[t.variable],s)}))}(a,e.props.outParamMapping,e.flow.evalSet),e.flow.next()};return t})()));