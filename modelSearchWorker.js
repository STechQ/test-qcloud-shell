!function(e,a){"object"==typeof exports&&"object"==typeof module?module.exports=a():"function"==typeof define&&define.amd?define([],a):"object"==typeof exports?exports.qcloud_shell=a():e.qcloud_shell=a()}(this,(()=>(()=>{"use strict";var e={};(e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})})(e);class a{static join(e,a){let t=(e.endsWith("/")?e.substring(0,e.length-1):e)+"/"+(a.startsWith("/")?a.substring(1):a);return t=t.endsWith("/")?t.substring(0,t.length-1):t,t}static uncamelizeAndCapitalize(e,a=" "){return e.replace(/([a-z0-9])([A-Z])/g,`$1${a}$2`).split(a).map((e=>e.charAt(0).toUpperCase()+e.slice(1))).join(a)}static getFullPath(e){let a="";if("module"===e.owner.objectType){const t="/"==e.path?"":"/";a=e.owner.name+t}const t=`${a}${e.path.replace(/^\/+/,"")}`;return""===t?e.name:`${t}/${e.name}`}}class t{constructor(){this.locationFinder=(e,a,t,n)=>{const i=this.ParseQJsonContent(e);if(!(null==i?void 0:i.pJson)||!Array.isArray(i.pJson))return Promise.resolve();for(const e of i.pJson)this.searchInComponent(e,a,(e=>n(e)));return Promise.resolve()}}searchInComponent(e,t,n){var i,s,l,o;const c=null!==(s=null===(i=e._Editor)||void 0===i?void 0:i.eID)&&void 0!==s?s:"unknown";if(e.P&&"object"==typeof e.P)for(const[i,s]of Object.entries(e.P))if("object"==typeof s&&null!==s&&"H"in s&&"string"==typeof s.H){const o=this.fillSearchValues(s.H,t);if(s.H.includes(t)){const r=o[0];n({path:`${a.uncamelizeAndCapitalize(c)}/ ${a.uncamelizeAndCapitalize("prop")}/ ${a.uncamelizeAndCapitalize(i)}`,detail:{compID:c,type:"prop",name:i,isCustomEvent:!1,externalVisible:void 0,lineNumber:r.lineNumber,column:r.column,editorLang:null!==(l=s.HL)&&void 0!==l?l:"QS",code:s.H,searchValue:t,eventState:e.P.isCustomEvent?"CustomNameChanged":"NotSet"}})}}if(e.E&&"object"==typeof e.E)for(const[i,s]of Object.entries(e.E))if("object"==typeof s&&null!==s&&"H"in s&&"string"==typeof s.H&&s.H.includes(t)){const l=this.fillSearchValues(s.H,t)[0];n({path:`${a.uncamelizeAndCapitalize(c)}/ ${a.uncamelizeAndCapitalize("event")}/ ${a.uncamelizeAndCapitalize(i)}`,detail:{compID:c,type:"event",name:i,isCustomEvent:!!s.C,externalVisible:void 0,lineNumber:l.lineNumber,column:l.column,editorLang:null!==(o=s.HL)&&void 0!==o?o:"QS",code:s.H,searchValue:t,eventState:e.E.isCustomEvent?"CustomNameChanged":"NotSet"}})}if(e.C&&"object"==typeof e.C)for(const a of Object.keys(e.C)){const i=e.C[a];if((null==i?void 0:i.c)&&Array.isArray(i.c))for(const e of i.c)this.searchInComponent(e,t,(e=>n(e)))}}ParseQJsonContent(e){let a=e;return e.includes("let pjson =")&&(a=e.split("let pjson =")[1].split(/;\s*export/)[0]),JSON.parse(a)}fillSearchValues(e,a,t={}){const n=t.isRegex?a:`(${i=a,i.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}+)`;var i;const s="g"+(t.caseSensitive?"":"i");let l=new RegExp(n,s),o=e.match(l),c=[],r="",p=1;return o&&o.forEach((t=>{var n;let i=e.indexOf(t),s=0,l=null===(n=e.slice(0,i).match(new RegExp("(\r\n)","gi")))||void 0===n?void 0:n.length;p+=l?Number(l):0,i>80&&(s=i-20),r=e.slice(s,i)+"<mark style='background-color: #D0D1E9'>"+t+"</mark>"+e.slice(i+t.length);let o=e.slice(0,i).split("\r\n")[l?Number(l):0].length+1;c.push({text:r,lineNumber:p,column:o}),e=e.substring(i+a.length)})),c}}class n{constructor(){this.locationFinder=(e,t,n,i)=>{const s=JSON.parse(e);return Object.entries(s).forEach((([e,s])=>{var l,o;switch(e){case"steps":s.forEach((e=>{var a;"humantask"===e.name?(e.props.forms.forEach((a=>{a.id.includes(t)&&i({path:`Steps / ${e.name} / Forms`,detail:{stepID:[e.ID],fileName:n}})})),e.props.actions.forEach((a=>{var s,l,o,c,r;(null===(l=null===(s=a.props)||void 0===s?void 0:s.function)||void 0===l?void 0:l.id.includes(t))&&i({path:`Steps / ${e.name} / Actions / ${a.label}`,detail:{stepID:[e.ID],fileName:n}}),null===(r=null===(c=null===(o=a.props)||void 0===o?void 0:o.function)||void 0===c?void 0:c.mapping)||void 0===r||r.inParamMapping.forEach((s=>{"constant"==s.mapping.type&&s.mapping.value.includes(t)&&i({path:`Steps / ${e.name} / Actions / ${a.label} / Mapping`,detail:{stepID:[e.ID],fileName:n,mappingName:s.variable.value}})}))}))):"subFlow"===e.name&&(e.props.id.includes(t)&&i({path:`Steps / ${e.name}`,detail:{stepID:[e.ID],fileName:n}}),null===(a=e.props.mapping.inParamMapping)||void 0===a||a.forEach((a=>{"constant"==a.mapping.type&&a.mapping.value.includes(t)&&i({path:`Steps / ${e.name} / Mapping`,detail:{stepID:[e.ID],fileName:n,mappingName:a.variable.value}})})))}));break;case"store":Object.values(s.input).forEach((e=>{switch(e.type){case"constant":e.ID.includes(t)&&i({path:`Store / Input / ${e.ID}`,detail:{stepID:[],fileName:n,mappingName:e.name}});break;case"dataType":e.objectID.includes(t)&&i({path:`Store / Input / ${e.objectID}`,detail:{stepID:[],fileName:n,mappingName:e.name}})}})),Object.values(s.output).forEach((e=>{switch(e.type){case"constant":e.ID.includes(t)&&i({path:`Store / Output / ${e.ID}`,detail:{stepID:[],fileName:n,mappingName:e.name}});break;case"dataType":e.objectID.includes(t)&&i({path:`Store / Output / ${e.objectID}`,detail:{stepID:[],fileName:n,mappingName:e.name}})}}));break;case"businessKeyGenerationFunction":case"fileDeleteFunction":case"fileDownloadFunction":case"fileUploadFunction":s.id.includes(t)&&i({path:`General / ${a.uncamelizeAndCapitalize(e)}`,detail:{stepID:[],fileName:n}}),null===(o=null===(l=s.mapping)||void 0===l?void 0:l.inParamMapping)||void 0===o||o.forEach((s=>{"constant"==s.mapping.type&&s.mapping.value.includes(t)&&i({path:`General / ${a.uncamelizeAndCapitalize(e)} / Mapping`,detail:{stepID:[],fileName:n,mappingName:s.variable.value}})}))}})),Promise.resolve()}}}class i{constructor(){this.locationFinder=(e,t,n,i)=>{const s=JSON.parse(e);return Object.entries(s).forEach((([e,s])=>{switch(e){case"steps":s.forEach((e=>{var s,l,o,c,r;const p=e.name,u=e.props;if(u)switch(p){case"code":if(null===(s=u.code)||void 0===s?void 0:s.includes(t)){const a=u.code.split("\n").findIndex((e=>e.includes(t)))+1,s=u.code.split("\n")[a-1].indexOf(t)+1;i({path:"Steps / Script",detail:{stepID:[e.ID],fileName:n,code:{startLine:a,endLine:a,startColumn:s,endColumn:s+t.length}}})}break;case"subFlow":u.id.includes(t)&&i({path:`Steps / ${e.name}`,detail:{stepID:[e.ID],fileName:n}}),null===(l=u.mapping.inParamMapping)||void 0===l||l.forEach((a=>{var s;"constant"==a.mapping.type&&(null===(s=a.mapping.value)||void 0===s?void 0:s.includes(t))&&i({path:`Steps / ${e.name} / Mapping`,detail:{stepID:[e.ID],fileName:n,mappingName:a.variable.value}})}));break;case"restServiceCall":case"soapServiceCall":(null===(o=u.id)||void 0===o?void 0:o.includes(t))&&i({path:`Steps / ${a.uncamelizeAndCapitalize(e.name)}`,detail:{stepID:[e.ID],fileName:n}}),null===(r=null===(c=null==u?void 0:u.mapping)||void 0===c?void 0:c.inParamMapping)||void 0===r||r.forEach((s=>{var l;"constant"==s.mapping.type&&(null===(l=s.mapping.value)||void 0===l?void 0:l.includes(t))&&i({path:`Steps / ${a.uncamelizeAndCapitalize(e.name)} / Mapping`,detail:{stepID:[e.ID],fileName:n,mappingName:s.variable.value}})}));break;case"s3FileUpload":case"s3FileDownload":case"s3FileDelete":const p=u,d=a.uncamelizeAndCapitalize(e.name);[["Access Key Id",p.accessKeyId.value],["Endpoint",p.endpoint.value],["Region",p.region.value],["Secret Access Key",p.secretAccessKey.value]].forEach((([a,s])=>{(null==s?void 0:s.includes(t))&&i({path:`Steps / ${d} / ${a}`,detail:{stepID:[e.ID],fileName:n}})}))}}));break;case"store":const e=(e,a)=>{var s,l;switch(e.type){case"constant":(null===(s=e.ID)||void 0===s?void 0:s.includes(t))&&i({path:`Store / ${a} / ${e.name}`,detail:{stepID:[],fileName:n,mappingName:e.name}});break;case"dataType":(null===(l=e.objectID)||void 0===l?void 0:l.includes(t))&&i({path:`Store / ${a} / ${e.name}`,detail:{stepID:[],fileName:n,mappingName:e.name}})}};Object.values(s.input).forEach((a=>e(a,"Input"))),Object.values(s.output).forEach((a=>e(a,"Output"))),Object.values(s.vars||{}).forEach((a=>e(a,"Local Variables")))}})),Promise.resolve()}}}class s{constructor(){this.locationFinder=(e,a,t,n)=>{const i=JSON.parse(e);return Object.values(i.attributes).forEach((e=>{switch(e.type){case"constant":e.ID.includes(a)&&n({detail:{fileName:t},path:`Attributes / ${e.name}`});break;case"dataType":e.objectID.includes(a)&&n({detail:{fileName:t},path:`Attributes / ${e.name}`})}})),Promise.resolve()}}}class l{constructor(){this.locationFinder=(e,a,t,n)=>{const i=JSON.parse(e);return"constant"===i.hostKey.type&&i.hostKey.value.includes(a)&&n({path:"Host Key",detail:{fileName:t}}),Object.values(i.store.input).forEach((e=>{this.searchVarible(e,a,t,"Input",n)})),Object.values(i.store.output).forEach((e=>{this.searchVarible(e,a,t,"Output",n)})),Promise.resolve()}}searchVarible(e,t,n,i,s){switch(e.type){case"constant":e.ID.includes(t)&&s({path:`${i} / ${a.uncamelizeAndCapitalize(e.name)}`,detail:{fileName:n}});break;case"dataType":e.objectID.includes(t)&&s({path:`${i} / ${a.uncamelizeAndCapitalize(e.name)}`,detail:{fileName:n}})}}}class o{constructor(){this.locationFinder=(e,a,t,n)=>{var i;const s=JSON.parse(e);return"constant"===(null===(i=s.userId)||void 0===i?void 0:i.type)&&s.userId.value.includes(a)&&n({path:"User ID",detail:{fileName:t}}),s.slaInfo.forEach((e=>{e.escalationFunctionId.includes(a)&&n({path:e.name,detail:{fileName:t}})})),Promise.resolve()}}}class c{constructor(){this.locationFinder=(e,a,t,n)=>{var i;return(null===(i=JSON.parse(e).functionModel)||void 0===i?void 0:i.includes(a))&&n({path:"Function",detail:{fileName:t}}),Promise.resolve()}}}class r{constructor(){this.locationFinder=(e,a,t,n)=>{const i=JSON.parse(e);return"constant"===i.hostKey.type&&i.hostKey.value.includes(a)&&n({path:"Host Key",detail:{fileName:t}}),"constant"===i.methodName.type&&i.methodName.value.includes(a)&&n({path:"Method Name",detail:{fileName:t}}),"constant"===i.timeout.type&&i.timeout.value.includes(a)&&n({path:"Timeout",detail:{fileName:t}}),Object.values(i.store.input).forEach((e=>{this.searchVarible(e,a,t,"Input",n)})),Object.values(i.store.output).forEach((e=>{this.searchVarible(e,a,t,"Output",n)})),Promise.resolve()}}searchVarible(e,t,n,i,s){switch(e.type){case"constant":e.ID.includes(t)&&s({path:`${i} / ${a.uncamelizeAndCapitalize(e.name)}`,detail:{fileName:n}});break;case"dataType":e.objectID.includes(t)&&s({path:`${i} / ${a.uncamelizeAndCapitalize(e.name)}`,detail:{fileName:n}})}}}class p{constructor(){this.locationFinder=async(e,a,t,n)=>{const i=new RegExp(a,"gi");let s;for(;null!==(s=i.exec(e));){const a=e.substring(0,s.index).split("\n").length,i=s.index-e.lastIndexOf("\n",s.index),l=Math.max(0,s.index-20),o=e.slice(l,s.index)+`<mark style='background-color: #D0D1E9'>${s[0]}</mark>`+e.slice(s.index+s[0].length);n({path:t,detail:{lineNumber:a,column:i,code:e,searchValue:s[0],text:o}})}}}}return self.onmessage=async function(e){const a=e.data,{modelId:u,fileName:d,modelBody:m,modelType:h,searchValue:f}=a;try{let e;switch(h){case"qjson":e=new t;break;case"workflow":e=new n;break;case"flow":e=new i;break;case"dataType":e=new s;break;case"restService":case"soapService":e=new l;break;case"sla":e=new o;break;case"jobScheduler":e=new c;break;case"soapServiceV2":e=new r;break;case"css":e=new p;break;default:return void postMessage({type:"searchComplete",modelId:u})}const a=[],v=10;await e.locationFinder(m,f,d,(e=>{a.push(e),a.length>=v&&postMessage({type:"searchResult",modelId:u,searchResult:a.splice(0)})})),a.length>0&&postMessage({type:"searchResult",modelId:u,searchResult:a.splice(0)}),postMessage({type:"searchComplete",modelId:u})}catch(e){throw postMessage({type:"searchComplete",modelId:u}),new Error(`Model search failed for modelId: ${u}, error: ${e.message}`)}},e})()));