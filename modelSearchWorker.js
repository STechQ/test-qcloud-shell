!function(e,a){"object"==typeof exports&&"object"==typeof module?module.exports=a():"function"==typeof define&&define.amd?define([],a):"object"==typeof exports?exports.qcloud_shell=a():e.qcloud_shell=a()}(this,(()=>(()=>{"use strict";var e={};(e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})})(e);class a{static join(e,a){let t=(e.endsWith("/")?e.substring(0,e.length-1):e)+"/"+(a.startsWith("/")?a.substring(1):a);return t=t.endsWith("/")?t.substring(0,t.length-1):t,t}static uncamelizeAndCapitalize(e,a=" "){return e.replace(/([a-z0-9])([A-Z])/g,`$1${a}$2`).split(a).map((e=>e.charAt(0).toUpperCase()+e.slice(1))).join(a)}static getFullPath(e){let a="";if("module"===e.owner.objectType){const t="/"==e.path?"":"/";a=e.owner.name+t}const t=`${a}${e.path.replace(/^\/+/,"")}`;return""===t?e.name:`${t}/${e.name}`}}class t{constructor(){this.locationFinder=(e,a,t,i)=>{const n=this.ParseQJsonContent(e);if(!(null==n?void 0:n.pJson)||!Array.isArray(n.pJson))return Promise.resolve();for(const e of n.pJson)this.searchInComponent(e,a,(e=>i(e)));return Promise.resolve()}}searchInComponent(e,t,i){var n,l,s,o;const c=null!==(l=null===(n=e._Editor)||void 0===n?void 0:n.eID)&&void 0!==l?l:"unknown";if(e.P&&"object"==typeof e.P)for(const[n,l]of Object.entries(e.P))if("object"==typeof l&&null!==l&&"H"in l&&"string"==typeof l.H){const o=this.fillSearchValues(l.H,t);if(l.H.includes(t)){const p=o[0];i({path:`${a.uncamelizeAndCapitalize(c)}/ ${a.uncamelizeAndCapitalize("prop")}/ ${a.uncamelizeAndCapitalize(n)}`,detail:{compID:c,type:"prop",name:n,isCustomEvent:!1,externalVisible:void 0,lineNumber:p.lineNumber,column:p.column,editorLang:null!==(s=l.HL)&&void 0!==s?s:"QS",code:l.H,searchValue:t,eventState:e.P.isCustomEvent?"CustomNameChanged":"NotSet"}})}}if(e.E&&"object"==typeof e.E)for(const[n,l]of Object.entries(e.E))if("object"==typeof l&&null!==l&&"H"in l&&"string"==typeof l.H&&l.H.includes(t)){const s=this.fillSearchValues(l.H,t)[0];i({path:`${a.uncamelizeAndCapitalize(c)}/ ${a.uncamelizeAndCapitalize("event")}/ ${a.uncamelizeAndCapitalize(n)}`,detail:{compID:c,type:"event",name:n,isCustomEvent:!!l.C,externalVisible:void 0,lineNumber:s.lineNumber,column:s.column,editorLang:null!==(o=l.HL)&&void 0!==o?o:"QS",code:l.H,searchValue:t,eventState:e.E.isCustomEvent?"CustomNameChanged":"NotSet"}})}if(e.C&&"object"==typeof e.C)for(const a of Object.keys(e.C)){const n=e.C[a];if((null==n?void 0:n.c)&&Array.isArray(n.c))for(const e of n.c)this.searchInComponent(e,t,(e=>i(e)))}}ParseQJsonContent(e){let a=e;return e.includes("let pjson =")&&(a=e.split("let pjson =")[1].split(/;\s*export/)[0]),JSON.parse(a)}fillSearchValues(e,a,t={}){const i=t.isRegex?a:`(${n=a,n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}+)`;var n;const l="g"+(t.caseSensitive?"":"i");let s=new RegExp(i,l),o=e.match(s),c=[],p="",r=1;return o&&o.forEach((t=>{var i;let n=e.indexOf(t),l=0,s=null===(i=e.slice(0,n).match(new RegExp("(\r\n)","gi")))||void 0===i?void 0:i.length;r+=s?Number(s):0,n>80&&(l=n-20),p=e.slice(l,n)+"<mark style='background-color: #D0D1E9'>"+t+"</mark>"+e.slice(n+t.length);let o=e.slice(0,n).split("\r\n")[s?Number(s):0].length+1;c.push({text:p,lineNumber:r,column:o}),e=e.substring(n+a.length)})),c}}class i{constructor(){this.locationFinder=(e,t,i,n)=>{const l=JSON.parse(e);return Object.entries(l).forEach((([e,l])=>{var s,o;switch(e){case"steps":l.forEach((e=>{var a;"humantask"===e.name?(e.props.forms.forEach((a=>{a.id.includes(t)&&n({path:`Steps / ${e.name} / Forms`,detail:{stepID:[e.ID],fileName:i}})})),e.props.actions.forEach((a=>{var l,s,o,c,p;(null===(s=null===(l=a.props)||void 0===l?void 0:l.function)||void 0===s?void 0:s.id.includes(t))&&n({path:`Steps / ${e.name} / Actions / ${a.label}`,detail:{stepID:[e.ID],fileName:i}}),null===(p=null===(c=null===(o=a.props)||void 0===o?void 0:o.function)||void 0===c?void 0:c.mapping)||void 0===p||p.inParamMapping.forEach((l=>{"constant"==l.mapping.type&&l.mapping.value.includes(t)&&n({path:`Steps / ${e.name} / Actions / ${a.label} / Mapping`,detail:{stepID:[e.ID],fileName:i,mappingName:l.variable.value}})}))}))):"subFlow"===e.name&&(e.props.id.includes(t)&&n({path:`Steps / ${e.name}`,detail:{stepID:[e.ID],fileName:i}}),null===(a=e.props.mapping.inParamMapping)||void 0===a||a.forEach((a=>{"constant"==a.mapping.type&&a.mapping.value.includes(t)&&n({path:`Steps / ${e.name} / Mapping`,detail:{stepID:[e.ID],fileName:i,mappingName:a.variable.value}})})))}));break;case"store":Object.values(l.input).forEach((e=>{switch(e.type){case"constant":e.ID.includes(t)&&n({path:`Store / Input / ${e.ID}`,detail:{stepID:[],fileName:i,mappingName:e.name}});break;case"dataType":e.objectID.includes(t)&&n({path:`Store / Input / ${e.objectID}`,detail:{stepID:[],fileName:i,mappingName:e.name}})}})),Object.values(l.output).forEach((e=>{switch(e.type){case"constant":e.ID.includes(t)&&n({path:`Store / Output / ${e.ID}`,detail:{stepID:[],fileName:i,mappingName:e.name}});break;case"dataType":case"dataSet":e.objectID.includes(t)&&n({path:`Store / Output / ${e.objectID}`,detail:{stepID:[],fileName:i,mappingName:e.name}})}}));break;case"businessKeyGenerationFunction":case"fileDeleteFunction":case"fileDownloadFunction":case"fileUploadFunction":l.id.includes(t)&&n({path:`General / ${a.uncamelizeAndCapitalize(e)}`,detail:{stepID:[],fileName:i}}),null===(o=null===(s=l.mapping)||void 0===s?void 0:s.inParamMapping)||void 0===o||o.forEach((l=>{"constant"==l.mapping.type&&l.mapping.value.includes(t)&&n({path:`General / ${a.uncamelizeAndCapitalize(e)} / Mapping`,detail:{stepID:[],fileName:i,mappingName:l.variable.value}})}))}})),Promise.resolve()}}}class n{constructor(){this.locationFinder=(e,t,i,n)=>{const l=JSON.parse(e);return Object.entries(l).forEach((([e,l])=>{switch(e){case"steps":l.forEach((e=>{var l,s,o,c,p,r,d,u;const m=e.name,h=e.props;if(h)switch(m){case"code":if(null===(l=h.code)||void 0===l?void 0:l.includes(t)){const a=h.code.split("\n").findIndex((e=>e.includes(t)))+1,l=h.code.split("\n")[a-1].indexOf(t)+1;n({path:"Steps / Script",detail:{stepID:[e.ID],fileName:i,code:{startLine:a,endLine:a,startColumn:l,endColumn:l+t.length}}})}break;case"subFlow":h.id.includes(t)&&n({path:`Steps / ${e.name}`,detail:{stepID:[e.ID],fileName:i}}),null===(s=h.mapping.inParamMapping)||void 0===s||s.forEach((a=>{var l;"constant"==a.mapping.type&&(null===(l=a.mapping.value)||void 0===l?void 0:l.includes(t))&&n({path:`Steps / ${e.name} / Mapping`,detail:{stepID:[e.ID],fileName:i,mappingName:a.variable.value}})}));break;case"restServiceCall":case"soapServiceCall":(null===(o=h.id)||void 0===o?void 0:o.includes(t))&&n({path:`Steps / ${a.uncamelizeAndCapitalize(e.name)}`,detail:{stepID:[e.ID],fileName:i}}),null===(p=null===(c=null==h?void 0:h.mapping)||void 0===c?void 0:c.inParamMapping)||void 0===p||p.forEach((l=>{var s;"constant"==l.mapping.type&&(null===(s=l.mapping.value)||void 0===s?void 0:s.includes(t))&&n({path:`Steps / ${a.uncamelizeAndCapitalize(e.name)} / Mapping`,detail:{stepID:[e.ID],fileName:i,mappingName:l.variable.value}})}));break;case"s3FileUpload":case"s3FileDownload":case"s3FileDelete":const m=h,v=a.uncamelizeAndCapitalize(e.name);[["Access Key Id",m.accessKeyId.value],["Endpoint",m.endpoint.value],["Region",m.region.value],["Secret Access Key",m.secretAccessKey.value]].forEach((([a,l])=>{(null==l?void 0:l.includes(t))&&n({path:`Steps / ${v} / ${a}`,detail:{stepID:[e.ID],fileName:i}})}));break;case"dbEntity":(null===(r=h.id)||void 0===r?void 0:r.includes(t))&&n({path:`Steps / ${a.uncamelizeAndCapitalize(e.name)}`,detail:{stepID:[e.ID],fileName:i}}),null===(u=null===(d=null==h?void 0:h.mapping)||void 0===d?void 0:d.inParamMapping)||void 0===u||u.forEach((l=>{var s;"constant"==l.mapping.type&&(null===(s=l.mapping.value)||void 0===s?void 0:s.includes(t))&&n({path:`Steps / ${a.uncamelizeAndCapitalize(e.name)} / Mapping`,detail:{stepID:[e.ID],fileName:i,mappingName:l.variable.value}})}))}}));break;case"store":const e=(e,a)=>{var l,s;switch(e.type){case"constant":(null===(l=e.ID)||void 0===l?void 0:l.includes(t))&&n({path:`Store / ${a} / ${e.name}`,detail:{stepID:[],fileName:i,mappingName:e.name}});break;case"dataType":case"dataSet":(null===(s=e.objectID)||void 0===s?void 0:s.includes(t))&&n({path:`Store / ${a} / ${e.name}`,detail:{stepID:[],fileName:i,mappingName:e.name}})}};Object.values(l.input).forEach((a=>e(a,"Input"))),Object.values(l.output).forEach((a=>e(a,"Output"))),Object.values(l.vars||{}).forEach((a=>e(a,"Local Variables")))}})),Promise.resolve()}}}class l{constructor(){this.locationFinder=(e,a,t,i)=>{const n=JSON.parse(e);return Object.values(n.attributes).forEach((e=>{switch(e.type){case"constant":e.ID.includes(a)&&i({detail:{fileName:t},path:`Attributes / ${e.name}`});break;case"dataType":case"dataSet":e.objectID.includes(a)&&i({detail:{fileName:t},path:`Attributes / ${e.name}`})}})),Promise.resolve()}}}class s{constructor(){this.locationFinder=(e,a,t,i)=>{const n=JSON.parse(e);return"constant"===n.hostKey.type&&n.hostKey.value.includes(a)&&i({path:"Host Key",detail:{fileName:t}}),Object.values(n.store.input).forEach((e=>{this.searchVarible(e,a,t,"Input",i)})),Object.values(n.store.output).forEach((e=>{this.searchVarible(e,a,t,"Output",i)})),Promise.resolve()}}searchVarible(e,t,i,n,l){switch(e.type){case"constant":e.ID.includes(t)&&l({path:`${n} / ${a.uncamelizeAndCapitalize(e.name)}`,detail:{fileName:i}});break;case"dataType":case"dataSet":e.objectID.includes(t)&&l({path:`${n} / ${a.uncamelizeAndCapitalize(e.name)}`,detail:{fileName:i}})}}}class o{constructor(){this.locationFinder=(e,a,t,i)=>{var n;const l=JSON.parse(e);return"constant"===(null===(n=l.userId)||void 0===n?void 0:n.type)&&l.userId.value.includes(a)&&i({path:"User ID",detail:{fileName:t}}),l.slaInfo.forEach((e=>{e.escalationFunctionId.includes(a)&&i({path:e.name,detail:{fileName:t}})})),Promise.resolve()}}}class c{constructor(){this.locationFinder=(e,a,t,i)=>{var n;return(null===(n=JSON.parse(e).functionModel)||void 0===n?void 0:n.includes(a))&&i({path:"Function",detail:{fileName:t}}),Promise.resolve()}}}class p{constructor(){this.locationFinder=(e,a,t,i)=>{const n=JSON.parse(e);return"constant"===n.hostKey.type&&n.hostKey.value.includes(a)&&i({path:"Host Key",detail:{fileName:t}}),"constant"===n.methodName.type&&n.methodName.value.includes(a)&&i({path:"Method Name",detail:{fileName:t}}),"constant"===n.timeout.type&&n.timeout.value.includes(a)&&i({path:"Timeout",detail:{fileName:t}}),Object.values(n.store.input).forEach((e=>{this.searchVarible(e,a,t,"Input",i)})),Object.values(n.store.output).forEach((e=>{this.searchVarible(e,a,t,"Output",i)})),Promise.resolve()}}searchVarible(e,t,i,n,l){switch(e.type){case"constant":e.ID.includes(t)&&l({path:`${n} / ${a.uncamelizeAndCapitalize(e.name)}`,detail:{fileName:i}});break;case"dataType":case"dataSet":e.objectID.includes(t)&&l({path:`${n} / ${a.uncamelizeAndCapitalize(e.name)}`,detail:{fileName:i}})}}}class r{constructor(){this.locationFinder=async(e,a,t,i)=>{const n=new RegExp(a,"gi");let l;for(;null!==(l=n.exec(e));){const a=e.substring(0,l.index).split("\n").length,n=l.index-e.lastIndexOf("\n",l.index),s=Math.max(0,l.index-20),o=e.slice(s,l.index)+`<mark style='background-color: #D0D1E9'>${l[0]}</mark>`+e.slice(l.index+l[0].length);i({path:t,detail:{lineNumber:a,column:n,code:e,searchValue:l[0],text:o}})}}}}class d{constructor(){this.locationFinder=(e,t,i,n)=>{const l=JSON.parse(e);return Object.entries(l).forEach((([e,l])=>{switch(e){case"steps":l.forEach((e=>{var l,s,o,c,p,r,d;const u=e.name,m=e.props;if(m)switch(u){case"code":if(null===(l=m.code)||void 0===l?void 0:l.includes(t)){const a=m.code.split("\n").findIndex((e=>e.includes(t)))+1,l=m.code.split("\n")[a-1].indexOf(t)+1;n({path:"Steps / Script",detail:{stepID:[e.ID],fileName:i,code:{startLine:a,endLine:a,startColumn:l,endColumn:l+t.length}}})}break;case"restServiceCall":(null===(s=m.id)||void 0===s?void 0:s.includes(t))&&n({path:`Steps / ${a.uncamelizeAndCapitalize(e.name)}`,detail:{stepID:[e.ID],fileName:i}}),null===(c=null===(o=null==m?void 0:m.mapping)||void 0===o?void 0:o.inParamMapping)||void 0===c||c.forEach((l=>{var s;"constant"==l.mapping.type&&(null===(s=l.mapping.value)||void 0===s?void 0:s.includes(t))&&n({path:`Steps / ${a.uncamelizeAndCapitalize(e.name)} / Mapping`,detail:{stepID:[e.ID],fileName:i,mappingName:l.variable.value}})}));break;case"dbEntity":(null===(p=m.id)||void 0===p?void 0:p.includes(t))&&n({path:`Steps / ${a.uncamelizeAndCapitalize(e.name)}`,detail:{stepID:[e.ID],fileName:i}}),null===(d=null===(r=null==m?void 0:m.mapping)||void 0===r?void 0:r.inParamMapping)||void 0===d||d.forEach((l=>{var s;"constant"==l.mapping.type&&(null===(s=l.mapping.value)||void 0===s?void 0:s.includes(t))&&n({path:`Steps / ${a.uncamelizeAndCapitalize(e.name)} / Mapping`,detail:{stepID:[e.ID],fileName:i,mappingName:l.variable.value}})}))}}));break;case"store":const e=(e,a)=>{var l,s;switch(e.type){case"constant":(null===(l=e.ID)||void 0===l?void 0:l.includes(t))&&n({path:`Store / ${a} / ${e.name}`,detail:{stepID:[],fileName:i,mappingName:e.name}});break;case"dataType":(null===(s=e.objectID)||void 0===s?void 0:s.includes(t))&&n({path:`Store / ${a} / ${e.name}`,detail:{stepID:[],fileName:i,mappingName:e.name}})}};Object.values(l.input).forEach((a=>e(a,"Input"))),Object.values(l.output).forEach((a=>e(a,"Output"))),Object.values(l.vars||{}).forEach((a=>e(a,"Local Variables")))}})),Promise.resolve()}}}class u{constructor(){this.locationFinder=(e,a,t,i)=>{var n;return null===(n=JSON.parse(e).handlers)||void 0===n||n.forEach(((e,n)=>{e.trigger.modelId.includes(a)&&i({path:"Handlers / Model ID",detail:{fileName:t,handlerIndex:n}})})),Promise.resolve()}}}return self.onmessage=async function(e){const a=e.data,{modelId:m,fileName:h,modelBody:v,modelType:f,searchValue:b}=a;try{let e;switch(f){case"qjson":e=new t;break;case"workflow":e=new i;break;case"flow":e=new n;break;case"dataType":e=new l;break;case"restService":case"soapService":e=new s;break;case"sla":e=new o;break;case"jobScheduler":e=new c;break;case"soapServiceV2":e=new p;break;case"css":e=new r;break;case"endpoint":e=new u;break;case"befunc":e=new d;break;default:return void postMessage({type:"searchComplete",modelId:m})}const a=[],g=10;await e.locationFinder(v,b,h,(e=>{a.push(e),a.length>=g&&postMessage({type:"searchResult",modelId:m,searchResult:a.splice(0)})})),a.length>0&&postMessage({type:"searchResult",modelId:m,searchResult:a.splice(0)}),postMessage({type:"searchComplete",modelId:m})}catch(e){throw postMessage({type:"searchComplete",modelId:m}),new Error(`Model search failed for modelId: ${m}, error: ${e.message}`)}},e})()));