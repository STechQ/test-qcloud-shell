"use strict";(self.webpackChunkqcloud_shell=self.webpackChunkqcloud_shell||[]).push([[9175],{7887:(n,e,t)=>{t.d(e,{Z:()=>r});var a=t(1864),s=t.n(a),o=t(352),i=t.n(o)()(s());i.push([n.id,"\n.content-area[data-v-383d2d42] {\n  overflow-y: scroll;\n  height: 100%;\n}\n.tables-area[data-v-383d2d42] {\n  width: 70%;\n  margin-left: 15%;\n  margin-top: 10px;\n}\n.section-area[data-v-383d2d42] {\n  margin-bottom: 25px;\n}\n.header-text[data-v-383d2d42] {\n  font-weight: bold;\n  margin-bottom: 5px;\n}\n.btn-action[data-v-383d2d42] {\n  margin-left: 10px;\n}\n","",{version:3,sources:["webpack://./src/presentation/vue3/pages/superuser.vue"],names:[],mappings:";AA4SA;EACE,kBAAkB;EAClB,YAAY;AACd;AAEA;EACE,UAAU;EACV,gBAAgB;EAChB,gBAAgB;AAClB;AAEA;EACE,mBAAmB;AACrB;AAEA;EACE,iBAAiB;EACjB,kBAAkB;AACpB;AAEA;EACE,iBAAiB;AACnB",sourcesContent:['<script setup lang="ts">\nimport { defineAsyncComponent, onBeforeMount, onMounted, ref } from "vue";\nimport { AuthenticationType, IDomain, ISystemUser, ITenantUser } from \'@stechquick/algae/lib/qCloudTemp/quickCloud\';\nimport { container } from \'../../../domain/core/diContainer\';\nimport { routeDefinition } from \'../../../domain/presentation/IRouter\';\nimport { ISystemUserManagement } from \'../../../domain/useCase/ISystemUserManagement\';\nimport { IUseCaseExecutor } from \'../../../domain/useCase/IUseCaseExecutor\';\nimport { ILocalization } from "../../../domain/infrastructure/ILocalization";\nimport { IDialog } from "../../../domain/presentation/IDialog";\nimport { CreatePromiseData } from "@stechquick/algae/lib/helpers/createPromiseData";\n\ninterface IInitOptions {\n  domains?: boolean;\n  tenants?: boolean;\n  systemUsers?: boolean;\n}\n\ninterface ITenantDomainRelation {\n  domainID: string;\n  tenantID: string;\n  domainName: string;\n  tenantName: string;\n  loginType: AuthenticationType;\n}\n\nrouteDefinition({ noAuth: true });\n\nconst executor = container.resolve<IUseCaseExecutor>(IUseCaseExecutor);\nconst systemUserManagement = container.resolve<ISystemUserManagement>(ISystemUserManagement);\nconst localization = container.resolve<ILocalization>(ILocalization);\nconst dialog = container.resolve<IDialog>(IDialog);\n\nconst domains = ref<Array<IDomain>>([]);\nconst tenants = ref<Array<ITenantUser>>([]);\nconst domainTenantRelations = ref<Array<ITenantDomainRelation>>([]);\nconst systemUsers = ref<Array<ISystemUser>>([]);\n\nfunction fillRelationTableData(domains: Array<IDomain>, tenants: Array<ITenantUser>) {\n  const items: Array<ITenantDomainRelation> = [];\n\n  tenants.forEach(tenant => {\n    const relations = tenant.tenantRelations;\n    if (!relations) { return; }\n\n    relations.forEach(relation => {\n      const domain = domains.find(i => i.ID == relation.tenantID)!;\n      const item: ITenantDomainRelation = {\n        domainID: relation.tenantID,\n        domainName: domain.name,\n        tenantID: tenant.ID,\n        tenantName: tenant.name,\n        loginType: relation.loginType,\n      }\n      items.push(item);\n    });\n  });\n\n  domainTenantRelations.value = items;\n}\n\nasync function getData(options: IInitOptions) {\n  await executor.execute(async () => {\n    const domainsProm = options.domains ? systemUserManagement.listDomains() : (async () => domains.value)();\n    const tenantsProm = options.tenants ? systemUserManagement.listTenants() : (async () => tenants.value)();\n    const systemUsersProm = options.systemUsers ? systemUserManagement.listSystemUsers() : (async () => systemUsers.value)();\n\n    [domains.value, tenants.value, systemUsers.value] = await Promise.all([domainsProm, tenantsProm, systemUsersProm]);\n\n    if (options.tenants) {\n      fillRelationTableData(domains.value, tenants.value);\n    }\n  }, { loading: true });\n}\n\nconst checkUserProm = CreatePromiseData<void>();\n\nonBeforeMount(async () => {\n  await executor.execute(async () => {\n    await systemUserManagement.checkUser();\n    checkUserProm.resolver();\n  }, { loading: true });\n});\n\nonMounted(async () => {\n  await checkUserProm.promise;\n  await getData({ domains: true, tenants: true, systemUsers: true });\n});\n\nconst dtBaseOptions = {\n  filterable: false, perPage: 10, perPageValues: [],\n  sortIcon: { base: \'mdi\', is: \'mdi mdi-unfold-less-horizontal\', up: \'mdi mdi-arrow-up\', down: \'mdi mdi-arrow-down\' },\n};\n\nconst domainsDtOptions = {\n  ...dtBaseOptions,\n  headings: {\n    ID: "Domain ID",\n    name: "Domain Name",\n    dbName: "Database Name",\n    createdBy: localization.get(\'applicationListcreatedByHeader\'),\n    createDate: localization.get(\'applicationListcreatedDateHeader\'),\n  }\n};\n\nconst tenantsDtOptions = {\n  ...dtBaseOptions,\n  headings: {\n    ID: "Tenant ID",\n    name: " Tenant Name",\n    createdBy: localization.get(\'applicationListcreatedByHeader\'),\n    createDate: localization.get(\'applicationListcreatedDateHeader\'),\n  }\n};\n\nconst relationsDtOptions = {\n  ...dtBaseOptions,\n  headings: {\n    domainID: "Domain ID",\n    domainName: "Domain Name",\n    tenantID: "Tenant ID",\n    tenantName: "Tenant Name",\n    loginType: "Login Type",\n  }\n};\n\nconst systemUsersDtOptions = {\n  ...dtBaseOptions,\n  headings: {\n    ID: "User ID",\n    userName: "Domain Name",\n    loginType: "Login Type",\n    createdBy: localization.get(\'applicationListcreatedByHeader\'),\n    createDate: localization.get(\'applicationListcreatedDateHeader\'),\n  }\n};\n\nlet dtOptions: any = { month: \'2-digit\', day: \'2-digit\', year: \'numeric\', hour: \'numeric\', minute: \'numeric\', second: \'numeric\' };\nconst domainsDatatableColumns = ref([\'ID\', \'name\', \'dbName\', \'createdBy\', \'createDate\', "actions"]);\nconst tenantsDatatableColumns = ref([\'ID\', \'name\', \'createdBy\', \'createDate\', "actions"]);\nconst relationsDatatableColumns = ref([\'domainID\', \'domainName\', \'tenantID\', \'tenantName\', "loginType", "actions"]);\nconst systemUsersDatatableColumns = ref([\'ID\', \'userName\', "loginType", \'createdBy\', \'createDate\', "actions"]);\nconst domainsDataTable = ref(domainsDtOptions);\nconst tenantsDataTable = ref(tenantsDtOptions);\nconst relationsDataTable = ref(relationsDtOptions);\nconst systemUsersDataTable = ref(systemUsersDtOptions);\n\nasync function createNewDomian() {\n  const closeCb = async (reason: "close" | "outclick" | "component") => {\n    if (reason != "component") { return; }\n    await getData({ domains: true });\n  };\n\n  dialog.showDialog(defineAsyncComponent(() => import(`../components/dialogs/systemuser/createDomain.vue`)), { closable: true, title: "Create Domain", closeCb }, {});\n}\n\nasync function createNewTenant() {\n  const closeCb = async (reason: "close" | "outclick" | "component") => {\n    if (reason != "component") { return; }\n    await getData({ tenants: true });\n  };\n\n  dialog.showDialog(defineAsyncComponent(() => import(`../components/dialogs/systemuser/createTenant.vue`)), { closable: true, title: "Create Tenant", closeCb }, {});\n}\n\nasync function createNewRelation() {\n  const closeCb = async (reason: "close" | "outclick" | "component") => {\n    if (reason != "component") { return; }\n    await getData({ domains: true, tenants: true });\n  };\n\n  const domainOptions = domains.value.map(i => { return { text: i.name, value: i.ID } });\n  const tenantOptions = tenants.value.map(i => { return { text: i.name, value: i.ID } });\n\n  dialog.showDialog(defineAsyncComponent(\n    () => import(`../components/dialogs/systemuser/attachDomainToTenant.vue`)),\n    { closable: true, title: "Attach Domain To Tenant", closeCb },\n    { domainOptions, tenantOptions },\n  );\n}\n\nasync function createNewSystemUSer() {\n  const closeCb = async (reason: "close" | "outclick" | "component") => {\n    if (reason != "component") { return; }\n    await getData({ systemUsers: true });\n  };\n\n  dialog.showDialog(defineAsyncComponent(() => import(`../components/dialogs/systemuser/createSystemUser.vue`)), { closable: true, title: "Create New System User", closeCb }, {});\n}\n\nasync function openUsersDialog(dbName: string) {\n  dialog.showDialog(defineAsyncComponent(\n    () => import(`../components/user/listUsers.vue`)),\n    { closable: true, title: `${dbName}: Users`, width: "1350px", maxHeight: "900px", },\n    { dbName }\n  );\n}\n\nasync function deleteDomian(domainID: string, domainName: string) {\n  await executor.execute(async () => {\n    await systemUserManagement.deleteDomain(domainID, domainName);\n    await getData({ domains: true, tenants: true });\n  }, { loading: true });\n}\n\nasync function deleteTenant(tenantID: string, tenantName: string) {\n  await executor.execute(async () => {\n    await systemUserManagement.deleteTenant(tenantID, tenantName);\n    await getData({ tenants: true });\n  }, { loading: true });\n}\n\nasync function deleteSystemUser(systemUserID: string, systemUserName: string) {\n  await executor.execute(async () => {\n    await systemUserManagement.deleteSystemUser(systemUserID, systemUserName);\n    await getData({ systemUsers: true });\n  }, { loading: true });\n}\n\nasync function removeRelation(domainID: string, tenantID: string, domainName: string, tenantName: string) {\n  await executor.execute(async () => {\n    await systemUserManagement.detachDomainFromTenant(domainID, tenantID, domainName, tenantName);\n    await getData({ tenants: true });\n  }, { loading: true });\n}\n\n<\/script>\n<template>\n  <div class="content-area">\n    <div class="tables-area">\n      <div class="section-area">\n        <div>\n          <button @click="getData({ domains: true, tenants: true, systemUsers: true })">Refresh Tables</button>\n        </div>\n      </div>\n      <div class="section-area">\n        <div class="header-text">Domains \n          <button class="btn-action" @click="createNewDomian()">Create New Domain</button></div>\n        <div>\n          <v-client-table ref=\'table\' :data="domains" :columns="domainsDatatableColumns" :options="domainsDataTable">\n            <template #createdDate="props">\n              <span>{{ new Intl.DateTimeFormat("tr-TR", dtOptions).format(new Date(props.row.createDate)) }}</span>\n            </template>\n            <template #actions="props">\n              <div>\n                <button class="btn-action" @click="openUsersDialog(props.row.dbName)">Users</button>\n                <button class="btn-action" @click="deleteDomian(props.row.ID, props.row.name)">Delete</button>\n              </div>\n            </template>\n          </v-client-table>\n        </div>\n      </div>\n      <div class="section-area">\n        <div class="header-text">Tenants <button @click="createNewTenant()">Create New Tenant</button></div>\n        <div>\n          <v-client-table ref=\'table\' :data="tenants" :columns="tenantsDatatableColumns" :options="tenantsDataTable">\n            <template #createdDate="props">\n              <span>{{ new Intl.DateTimeFormat("tr-TR", dtOptions).format(new Date(props.row.createDate)) }}</span>\n            </template>\n            <template #actions="props">\n              <div>\n                <button class="btn-action" @click="deleteTenant(props.row.ID, props.row.name)">Delete</button>\n              </div>\n            </template>\n          </v-client-table>\n        </div>\n      </div>\n      <div class="section-area">\n        <div class="header-text">Tenant & Domain Relations <button @click="createNewRelation()">Add New\n            Relation</button></div>\n        <div>\n          <v-client-table ref=\'table\' :data="domainTenantRelations" :columns="relationsDatatableColumns"\n            :options="relationsDataTable">\n            <template #actions="props">\n              <div>\n                <button\n                  @click="removeRelation(props.row.domainID, props.row.tenantID, props.row.domainName, props.row.tenantName)">Remove</button>\n              </div>\n            </template>\n          </v-client-table>\n        </div>\n      </div>\n      <div class="section-area">\n        <div class="header-text">System Users <button @click="createNewSystemUSer()">Create System User</button>\n        </div>\n        <div>\n          <v-client-table ref=\'table\' :data="systemUsers" :columns="systemUsersDatatableColumns"\n            :options="systemUsersDataTable">\n            <template #actions="props">\n              <div>\n                <button class="btn-action" @click="deleteSystemUser(props.row.ID, props.row.userName)">Delete</button>\n              </div>\n            </template>\n          </v-client-table>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<style scoped>\n.content-area {\n  overflow-y: scroll;\n  height: 100%;\n}\n\n.tables-area {\n  width: 70%;\n  margin-left: 15%;\n  margin-top: 10px;\n}\n\n.section-area {\n  margin-bottom: 25px;\n}\n\n.header-text {\n  font-weight: bold;\n  margin-bottom: 5px;\n}\n\n.btn-action {\n  margin-left: 10px;\n}\n</style>'],sourceRoot:""}]);const r=i},9175:(n,e,t)=>{t.r(e),t.d(e,{default:()=>j});var a=t(2068),s=t(9045),o=t(1407),i=t(3734),r=t(5078),c=t(1145),l=t(664),m=t(6595),d=t(2455),u=t(9185);const p={class:"content-area"},D={class:"tables-area"},y={class:"section-area"},g={class:"section-area"},b={class:"header-text"},v=(0,a.Uk)("Domains "),w=["onClick"],I=["onClick"],f={class:"section-area"},C={class:"header-text"},U=(0,a.Uk)("Tenants "),T=["onClick"],h={class:"section-area"},A={class:"header-text"},N=(0,a.Uk)("Tenant & Domain Relations "),x=["onClick"],k={class:"section-area"},B={class:"header-text"},_=(0,a.Uk)("System Users "),R=["onClick"],S=(0,a.aZ)({__name:"superuser",setup(n){(0,r.A)({noAuth:!0});const e=i.nC.resolve(l.y),S=i.nC.resolve(c.H),E=i.nC.resolve(m.w),H=i.nC.resolve(d.u),O=(0,o.iH)([]),L=(0,o.iH)([]),P=(0,o.iH)([]),M=(0,o.iH)([]);async function z(n){await e.execute((async()=>{const e=n.domains?S.listDomains():(async()=>O.value)(),t=n.tenants?S.listTenants():(async()=>L.value)(),a=n.systemUsers?S.listSystemUsers():(async()=>M.value)();[O.value,L.value,M.value]=await Promise.all([e,t,a]),n.tenants&&function(n,e){const t=[];e.forEach((e=>{const a=e.tenantRelations;a&&a.forEach((a=>{const s=n.find((n=>n.ID==a.tenantID)),o={domainID:a.tenantID,domainName:s.name,tenantID:e.ID,tenantName:e.name,loginType:a.loginType};t.push(o)}))})),P.value=t}(O.value,L.value)}),{loading:!0})}const F=(0,u.X)();(0,a.wF)((async()=>{await e.execute((async()=>{await S.checkUser(),F.resolver()}),{loading:!0})})),(0,a.bv)((async()=>{await F.promise,await z({domains:!0,tenants:!0,systemUsers:!0})}));const Z={filterable:!1,perPage:10,perPageValues:[],sortIcon:{base:"mdi",is:"mdi mdi-unfold-less-horizontal",up:"mdi mdi-arrow-up",down:"mdi mdi-arrow-down"}},q={...Z,headings:{ID:"Domain ID",name:"Domain Name",dbName:"Database Name",createdBy:E.get("applicationListcreatedByHeader"),createDate:E.get("applicationListcreatedDateHeader")}},W={...Z,headings:{ID:"Tenant ID",name:" Tenant Name",createdBy:E.get("applicationListcreatedByHeader"),createDate:E.get("applicationListcreatedDateHeader")}},V={...Z,headings:{domainID:"Domain ID",domainName:"Domain Name",tenantID:"Tenant ID",tenantName:"Tenant Name",loginType:"Login Type"}},Y={...Z,headings:{ID:"User ID",userName:"Domain Name",loginType:"Login Type",createdBy:E.get("applicationListcreatedByHeader"),createDate:E.get("applicationListcreatedDateHeader")}};let $={month:"2-digit",day:"2-digit",year:"numeric",hour:"numeric",minute:"numeric",second:"numeric"};const j=(0,o.iH)(["ID","name","dbName","createdBy","createDate","actions"]),X=(0,o.iH)(["ID","name","createdBy","createDate","actions"]),G=(0,o.iH)(["domainID","domainName","tenantID","tenantName","loginType","actions"]),J=(0,o.iH)(["ID","userName","loginType","createdBy","createDate","actions"]),K=(0,o.iH)(q),Q=(0,o.iH)(W),nn=(0,o.iH)(V),en=(0,o.iH)(Y);return(n,i)=>{const r=(0,a.up)("v-client-table");return(0,a.wg)(),(0,a.iD)("div",p,[(0,a._)("div",D,[(0,a._)("div",y,[(0,a._)("div",null,[(0,a._)("button",{onClick:i[0]||(i[0]=n=>z({domains:!0,tenants:!0,systemUsers:!0}))},"Refresh Tables")])]),(0,a._)("div",g,[(0,a._)("div",b,[v,(0,a._)("button",{class:"btn-action",onClick:i[1]||(i[1]=n=>async function(){H.showDialog((0,a.RC)((()=>t.e(419).then(t.bind(t,419)))),{closable:!0,title:"Create Domain",closeCb:async n=>{"component"==n&&await z({domains:!0})}},{})}())},"Create New Domain")]),(0,a._)("div",null,[(0,a.Wm)(r,{ref:"table",data:O.value,columns:j.value,options:K.value},{createdDate:(0,a.w5)((n=>[(0,a._)("span",null,(0,s.toDisplayString)(new Intl.DateTimeFormat("tr-TR",(0,o.SU)($)).format(new Date(n.row.createDate))),1)])),actions:(0,a.w5)((n=>[(0,a._)("div",null,[(0,a._)("button",{class:"btn-action",onClick:e=>async function(n){H.showDialog((0,a.RC)((()=>t.e(104).then(t.bind(t,104)))),{closable:!0,title:`${n}: Users`,width:"1350px",maxHeight:"900px"},{dbName:n})}(n.row.dbName)},"Users",8,w),(0,a._)("button",{class:"btn-action",onClick:t=>async function(n,t){await e.execute((async()=>{await S.deleteDomain(n,t),await z({domains:!0,tenants:!0})}),{loading:!0})}(n.row.ID,n.row.name)},"Delete",8,I)])])),_:1},8,["data","columns","options"])])]),(0,a._)("div",f,[(0,a._)("div",C,[U,(0,a._)("button",{onClick:i[2]||(i[2]=n=>async function(){H.showDialog((0,a.RC)((()=>t.e(3793).then(t.bind(t,3793)))),{closable:!0,title:"Create Tenant",closeCb:async n=>{"component"==n&&await z({tenants:!0})}},{})}())},"Create New Tenant")]),(0,a._)("div",null,[(0,a.Wm)(r,{ref:"table",data:L.value,columns:X.value,options:Q.value},{createdDate:(0,a.w5)((n=>[(0,a._)("span",null,(0,s.toDisplayString)(new Intl.DateTimeFormat("tr-TR",(0,o.SU)($)).format(new Date(n.row.createDate))),1)])),actions:(0,a.w5)((n=>[(0,a._)("div",null,[(0,a._)("button",{class:"btn-action",onClick:t=>async function(n,t){await e.execute((async()=>{await S.deleteTenant(n,t),await z({tenants:!0})}),{loading:!0})}(n.row.ID,n.row.name)},"Delete",8,T)])])),_:1},8,["data","columns","options"])])]),(0,a._)("div",h,[(0,a._)("div",A,[N,(0,a._)("button",{onClick:i[3]||(i[3]=n=>async function(){const n=O.value.map((n=>({text:n.name,value:n.ID}))),e=L.value.map((n=>({text:n.name,value:n.ID})));H.showDialog((0,a.RC)((()=>t.e(559).then(t.bind(t,559)))),{closable:!0,title:"Attach Domain To Tenant",closeCb:async n=>{"component"==n&&await z({domains:!0,tenants:!0})}},{domainOptions:n,tenantOptions:e})}())},"Add New Relation")]),(0,a._)("div",null,[(0,a.Wm)(r,{ref:"table",data:P.value,columns:G.value,options:nn.value},{actions:(0,a.w5)((n=>[(0,a._)("div",null,[(0,a._)("button",{onClick:t=>async function(n,t,a,s){await e.execute((async()=>{await S.detachDomainFromTenant(n,t,a,s),await z({tenants:!0})}),{loading:!0})}(n.row.domainID,n.row.tenantID,n.row.domainName,n.row.tenantName)},"Remove",8,x)])])),_:1},8,["data","columns","options"])])]),(0,a._)("div",k,[(0,a._)("div",B,[_,(0,a._)("button",{onClick:i[4]||(i[4]=n=>async function(){H.showDialog((0,a.RC)((()=>t.e(2290).then(t.bind(t,2290)))),{closable:!0,title:"Create New System User",closeCb:async n=>{"component"==n&&await z({systemUsers:!0})}},{})}())},"Create System User")]),(0,a._)("div",null,[(0,a.Wm)(r,{ref:"table",data:M.value,columns:J.value,options:en.value},{actions:(0,a.w5)((n=>[(0,a._)("div",null,[(0,a._)("button",{class:"btn-action",onClick:t=>async function(n,t){await e.execute((async()=>{await S.deleteSystemUser(n,t),await z({systemUsers:!0})}),{loading:!0})}(n.row.ID,n.row.userName)},"Delete",8,R)])])),_:1},8,["data","columns","options"])])])])])}}});var E=t(5701),H=t.n(E),O=t(8236),L=t.n(O),P=t(6080),M=t.n(P),z=t(6850),F=t.n(z),Z=t(7182),q=t.n(Z),W=t(9213),V=t.n(W),Y=t(7887),$={};$.styleTagTransform=V(),$.setAttributes=F(),$.insert=M().bind(null,"head"),$.domAPI=L(),$.insertStyleElement=q(),H()(Y.Z,$),Y.Z&&Y.Z.locals&&Y.Z.locals;const j=(0,t(1419).Z)(S,[["__scopeId","data-v-383d2d42"]])}}]);
//# sourceMappingURL=9175.js.map