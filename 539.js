"use strict";(self.webpackChunkqcloud_shell=self.webpackChunkqcloud_shell||[]).push([[539],{5451:(n,e,t)=>{t.d(e,{Z:()=>r});var a=t(1864),o=t.n(a),s=t(352),i=t.n(s)()(o());i.push([n.id,"\n.content-area[data-v-8dd3748a] {\n  overflow-y: scroll;\n  height: 100%;\n}\n.tables-area[data-v-8dd3748a] {\n  width: 70%;\n  margin-left: 15%;\n  margin-top: 10px;\n}\n.section-area[data-v-8dd3748a] {\n  margin-bottom: 25px;\n}\n.header-text[data-v-8dd3748a] {\n  font-weight: bold;\n  margin-bottom: 5px;\n}\n\n/* .btn-new-item {\n  float: right;\n} */\n","",{version:3,sources:["webpack://./src/presentation/vue3/pages/superuser.vue"],names:[],mappings:";AAoSA;EACE,kBAAkB;EAClB,YAAY;AACd;AAEA;EACE,UAAU;EACV,gBAAgB;EAChB,gBAAgB;AAClB;AAEA;EACE,mBAAmB;AACrB;AAEA;EACE,iBAAiB;EACjB,kBAAkB;AACpB;;AAEA;;GAEG",sourcesContent:['<script setup lang="ts">\nimport { defineAsyncComponent, onBeforeMount, onMounted, ref } from "vue";\nimport { AuthenticationType, IDomain, ISystemUser, ITenantUser } from \'@stechquick/algae/lib/qCloudTemp/quickCloud\';\nimport { container } from \'../../../domain/core/diContainer\';\nimport { routeDefinition } from \'../../../domain/presentation/IRouter\';\nimport { ISystemUserManagement } from \'../../../domain/useCase/ISystemUserManagement\';\nimport { IUseCaseExecutor } from \'../../../domain/useCase/IUseCaseExecutor\';\nimport { ILocalization } from "../../../domain/infrastructure/ILocalization";\nimport { IDialog } from "../../../domain/presentation/IDialog";\nimport { IViewModel } from "../../../domain/viewModel/IViewModel";\nimport { CreatePromiseData } from "@stechquick/algae/lib/helpers/createPromiseData";\n\ninterface IInitOptions {\n  domains?: boolean;\n  tenants?: boolean;\n  systemUsers?: boolean;\n}\n\ninterface ITenantDomainRelation {\n  domainID: string;\n  tenantID: string;\n  domainName: string;\n  tenantName: string;\n  loginType: AuthenticationType;\n}\n\nrouteDefinition({ noAuth: true });\n\nconst executor = container.resolve<IUseCaseExecutor>(IUseCaseExecutor);\nconst systemUserManagement = container.resolve<ISystemUserManagement>(ISystemUserManagement);\nconst localization = container.resolve<ILocalization>(ILocalization);\nconst dialog = container.resolve<IDialog>(IDialog);\n\nconst domains = ref<Array<IDomain>>([]);\nconst tenants = ref<Array<ITenantUser>>([]);\nconst domainTenantRelations = ref<Array<ITenantDomainRelation>>([]);\nconst systemUsers = ref<Array<ISystemUser>>([]);\n\nfunction fillRelationTableData(domains: Array<IDomain>, tenants: Array<ITenantUser>) {\n  const items: Array<ITenantDomainRelation> = [];\n\n  tenants.forEach(tenant => {\n    const relations = tenant.tenantRelations;\n    if (!relations) { return; }\n\n    relations.forEach(relation => {\n      const domain = domains.find(i => i.ID == relation.tenantID)!;\n      const item: ITenantDomainRelation = {\n        domainID: relation.tenantID,\n        domainName: domain.name,\n        tenantID: tenant.ID,\n        tenantName: tenant.name,\n        loginType: relation.loginType,\n      }\n      items.push(item);\n    });\n  });\n\n  domainTenantRelations.value = items;\n}\n\nasync function getData(options: IInitOptions) {\n  await executor.execute(async () => {\n    const domainsProm = options.domains ? systemUserManagement.listDomains() : (async () => domains.value)();\n    const tenantsProm = options.tenants ? systemUserManagement.listTenants() : (async () => tenants.value)();\n    const systemUsersProm = options.systemUsers ? systemUserManagement.listSystemUsers() : (async () => systemUsers.value)();\n\n    [domains.value, tenants.value, systemUsers.value] = await Promise.all([domainsProm, tenantsProm, systemUsersProm]);\n\n    if (options.tenants) {\n      fillRelationTableData(domains.value, tenants.value);\n    }\n  }, { loading: true });\n}\n\nconst checkUserProm = CreatePromiseData<void>();\n\nonBeforeMount(async () => {\n  await executor.execute(async () => {\n    await systemUserManagement.checkUser();\n    checkUserProm.resolver();\n  }, { loading: true });\n});\n\nonMounted(async () => {\n  await checkUserProm.promise;\n  await getData({ domains: true, tenants: true, systemUsers: true });\n});\n\nconst dtBasicOptions = {\n  filterable: false, perPage: 10, perPageValues: [],\n  sortIcon: { base: \'mdi\', is: \'mdi mdi-unfold-less-horizontal\', up: \'mdi mdi-arrow-up\', down: \'mdi mdi-arrow-down\' },\n};\n\nconst domainsDtOptions = {\n  ...dtBasicOptions,\n  headings: {\n    ID: "Domain ID",\n    name: "Domain Name",\n    dbName: "Database Name",\n    createdBy: localization.get(\'applicationListcreatedByHeader\'),\n    createDate: localization.get(\'applicationListcreatedDateHeader\'),\n  }\n};\n\nconst tenantsDtOptions = {\n  ...dtBasicOptions,\n  headings: {\n    ID: "Tenant ID",\n    name: " Tenant Name",\n    createdBy: localization.get(\'applicationListcreatedByHeader\'),\n    createDate: localization.get(\'applicationListcreatedDateHeader\'),\n  }\n};\n\nconst relationsDtOptions = {\n  ...dtBasicOptions,\n  headings: {\n    domainID: "Domain ID",\n    domainName: "Domain Name",\n    tenantID: "Tenant ID",\n    tenantName: "Tenant Name",\n    loginType: "Login Type",\n  }\n};\n\nconst systemUsersDtOptions = {\n  ...dtBasicOptions,\n  headings: {\n    ID: "User ID",\n    userName: "Domain Name",\n    loginType: "Login Type",\n    createdBy: localization.get(\'applicationListcreatedByHeader\'),\n    createDate: localization.get(\'applicationListcreatedDateHeader\'),\n  }\n};\n\nlet dtOptions: any = { month: \'2-digit\', day: \'2-digit\', year: \'numeric\', hour: \'numeric\', minute: \'numeric\', second: \'numeric\' };\nconst domainsDatatableColumns = ref([\'ID\', \'name\', \'dbName\', \'createdBy\', \'createDate\', "actions"]);\nconst tenantsDatatableColumns = ref([\'ID\', \'name\', \'createdBy\', \'createDate\', "actions"]);\nconst relationsDatatableColumns = ref([\'domainID\', \'domainName\', \'tenantID\', \'tenantName\', "loginType", "actions"]);\nconst systemUsersDatatableColumns = ref([\'ID\', \'userName\', "loginType", \'createdBy\', \'createDate\', "actions"]);\nconst domainsDataTable = ref(domainsDtOptions);\nconst tenantsDataTable = ref(tenantsDtOptions);\nconst relationsDataTable = ref(relationsDtOptions);\nconst systemUsersDataTable = ref(systemUsersDtOptions);\n\nasync function createNewDomian() {\n  const closeCb = async (reason: "close" | "outclick" | "component") => {\n    if (reason != "component") { return; }\n    await getData({ domains: true });\n  };\n\n  dialog.showDialog(defineAsyncComponent(() => import(`../components/dialogs/superuser/createDomain.vue`)), { closable: true, title: "Create Domain", closeCb }, {});\n}\n\nasync function createNewTenant() {\n  const closeCb = async (reason: "close" | "outclick" | "component") => {\n    if (reason != "component") { return; }\n    await getData({ tenants: true });\n  };\n\n  dialog.showDialog(defineAsyncComponent(() => import(`../components/dialogs/superuser/createTenant.vue`)), { closable: true, title: "Create Tenant", closeCb }, {});\n}\n\nasync function createNewRelation() {\n  const closeCb = async (reason: "close" | "outclick" | "component") => {\n    if (reason != "component") { return; }\n    await getData({ domains: true, tenants: true });\n  };\n\n  const domainOptions = domains.value.map(i => { return { text: i.name, value: i.ID } });\n  const tenantOptions = tenants.value.map(i => { return { text: i.name, value: i.ID } });\n\n  dialog.showDialog(defineAsyncComponent(\n    () => import(`../components/dialogs/superuser/attachDomainToTenant.vue`)),\n    { closable: true, title: "Attach Domain To Tenant", closeCb },\n    { domainOptions, tenantOptions },\n  );\n}\n\nasync function createNewSystemUSer() {\n  const closeCb = async (reason: "close" | "outclick" | "component") => {\n    if (reason != "component") { return; }\n    await getData({ systemUsers: true });\n  };\n\n  dialog.showDialog(defineAsyncComponent(() => import(`../components/dialogs/superuser/createSystemUser.vue`)), { closable: true, title: "Create New System User", closeCb }, {});\n}\n\nasync function deleteDomian(domainID: string, domainName: string) {\n  await executor.execute(async () => {\n    await systemUserManagement.deleteDomain(domainID, domainName);\n    await getData({ domains: true, tenants: true });\n  }, { loading: true });\n}\n\nasync function deleteTenant(tenantID: string, tenantName: string) {\n  await executor.execute(async () => {\n    await systemUserManagement.deleteTenant(tenantID, tenantName);\n    await getData({ tenants: true });\n  }, { loading: true });\n}\n\nasync function deleteSystemUser(systemUserID: string, systemUserName: string) {\n  await executor.execute(async () => {\n    await systemUserManagement.deleteSystemUser(systemUserID, systemUserName);\n    await getData({ systemUsers: true });\n  }, { loading: true });\n}\n\nasync function removeRelation(domainID: string, tenantID: string, domainName: string, tenantName: string) {\n  await executor.execute(async () => {\n    await systemUserManagement.detachDomainFromTenant(domainID, tenantID, domainName, tenantName);\n    await getData({ tenants: true });\n  }, { loading: true });\n}\n\n<\/script>\n<template>\n  <div class="content-area">\n    <div class="tables-area">\n      <div class="section-area">\n        <div>\n          <button @click="getData({ domains: true, tenants: true, systemUsers: true })">Refresh Tables</button>\n        </div>\n      </div>\n      <div class="section-area">\n        <div class="header-text">Domains <button @click="createNewDomian()" class="btn-new-item">Create New\n            Domain</button></div>\n        <div>\n          <v-client-table ref=\'table\' :data="domains" :columns="domainsDatatableColumns" :options="domainsDataTable">\n            <template #createdDate="props">\n              <span>{{ new Intl.DateTimeFormat("tr-TR", dtOptions).format(new Date(props.row.createDate)) }}</span>\n            </template>\n            <template #actions="props">\n              <div>\n                <button @click="deleteDomian(props.row.ID, props.row.name)">Delete</button>\n              </div>\n            </template>\n          </v-client-table>\n        </div>\n      </div>\n      <div class="section-area">\n        <div class="header-text">Tenants <button @click="createNewTenant()">Create New Tenant</button></div>\n        <div>\n          <v-client-table ref=\'table\' :data="tenants" :columns="tenantsDatatableColumns" :options="tenantsDataTable">\n            <template #createdDate="props">\n              <span>{{ new Intl.DateTimeFormat("tr-TR", dtOptions).format(new Date(props.row.createDate)) }}</span>\n            </template>\n            <template #actions="props">\n              <div>\n                <button @click="deleteTenant(props.row.ID, props.row.name)">Delete</button>\n              </div>\n            </template>\n          </v-client-table>\n        </div>\n      </div>\n      <div class="section-area">\n        <div class="header-text">Tenant & Domain Relations <button @click="createNewRelation()">Add New\n            Relation</button></div>\n        <div>\n          <v-client-table ref=\'table\' :data="domainTenantRelations" :columns="relationsDatatableColumns"\n            :options="relationsDataTable">\n            <template #actions="props">\n              <div>\n                <button\n                  @click="removeRelation(props.row.domainID, props.row.tenantID, props.row.domainName, props.row.tenantName)">Remove</button>\n              </div>\n            </template>\n          </v-client-table>\n        </div>\n      </div>\n      <div class="section-area">\n        <div class="header-text">System Users <button @click="createNewSystemUSer()">Create System User</button>\n        </div>\n        <div>\n          <v-client-table ref=\'table\' :data="systemUsers" :columns="systemUsersDatatableColumns"\n            :options="systemUsersDataTable">\n            <template #actions="props">\n              <div>\n                <button @click="deleteSystemUser(props.row.ID, props.row.userName)">Delete</button>\n              </div>\n            </template>\n          </v-client-table>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<style scoped>\n.content-area {\n  overflow-y: scroll;\n  height: 100%;\n}\n\n.tables-area {\n  width: 70%;\n  margin-left: 15%;\n  margin-top: 10px;\n}\n\n.section-area {\n  margin-bottom: 25px;\n}\n\n.header-text {\n  font-weight: bold;\n  margin-bottom: 5px;\n}\n\n/* .btn-new-item {\n  float: right;\n} */\n</style>'],sourceRoot:""}]);const r=i},4539:(n,e,t)=>{t.r(e),t.d(e,{default:()=>Y});var a=t(2068),o=t(9045),s=t(1407),i=t(3734),r=t(5078),l=t(1145),c=t(664),m=t(6595),d=t(2455),u=t(9185);const p={class:"content-area"},D={class:"tables-area"},y={class:"section-area"},g={class:"section-area"},v={class:"header-text"},w=(0,a.Uk)("Domains "),b=["onClick"],I={class:"section-area"},f={class:"header-text"},T=(0,a.Uk)("Tenants "),C=["onClick"],h={class:"section-area"},U={class:"header-text"},A=(0,a.Uk)("Tenant & Domain Relations "),N=["onClick"],k={class:"section-area"},x={class:"header-text"},B=(0,a.Uk)("System Users "),_=["onClick"],R=(0,a.aZ)({__name:"superuser",setup(n){(0,r.A)({noAuth:!0});const e=i.nC.resolve(c.y),R=i.nC.resolve(l.H),S=i.nC.resolve(m.w),E=i.nC.resolve(d.u),H=(0,s.iH)([]),O=(0,s.iH)([]),L=(0,s.iH)([]),M=(0,s.iH)([]);async function P(n){await e.execute((async()=>{const e=n.domains?R.listDomains():(async()=>H.value)(),t=n.tenants?R.listTenants():(async()=>O.value)(),a=n.systemUsers?R.listSystemUsers():(async()=>M.value)();[H.value,O.value,M.value]=await Promise.all([e,t,a]),n.tenants&&function(n,e){const t=[];e.forEach((e=>{const a=e.tenantRelations;a&&a.forEach((a=>{const o=n.find((n=>n.ID==a.tenantID)),s={domainID:a.tenantID,domainName:o.name,tenantID:e.ID,tenantName:e.name,loginType:a.loginType};t.push(s)}))})),L.value=t}(H.value,O.value)}),{loading:!0})}const z=(0,u.X)();(0,a.wF)((async()=>{await e.execute((async()=>{await R.checkUser(),z.resolver()}),{loading:!0})})),(0,a.bv)((async()=>{await z.promise,await P({domains:!0,tenants:!0,systemUsers:!0})}));const F={filterable:!1,perPage:10,perPageValues:[],sortIcon:{base:"mdi",is:"mdi mdi-unfold-less-horizontal",up:"mdi mdi-arrow-up",down:"mdi mdi-arrow-down"}},Z={...F,headings:{ID:"Domain ID",name:"Domain Name",dbName:"Database Name",createdBy:S.get("applicationListcreatedByHeader"),createDate:S.get("applicationListcreatedDateHeader")}},q={...F,headings:{ID:"Tenant ID",name:" Tenant Name",createdBy:S.get("applicationListcreatedByHeader"),createDate:S.get("applicationListcreatedDateHeader")}},V={...F,headings:{domainID:"Domain ID",domainName:"Domain Name",tenantID:"Tenant ID",tenantName:"Tenant Name",loginType:"Login Type"}},W={...F,headings:{ID:"User ID",userName:"Domain Name",loginType:"Login Type",createdBy:S.get("applicationListcreatedByHeader"),createDate:S.get("applicationListcreatedDateHeader")}};let G={month:"2-digit",day:"2-digit",year:"numeric",hour:"numeric",minute:"numeric",second:"numeric"};const Y=(0,s.iH)(["ID","name","dbName","createdBy","createDate","actions"]),j=(0,s.iH)(["ID","name","createdBy","createDate","actions"]),X=(0,s.iH)(["domainID","domainName","tenantID","tenantName","loginType","actions"]),J=(0,s.iH)(["ID","userName","loginType","createdBy","createDate","actions"]),K=(0,s.iH)(Z),Q=(0,s.iH)(q),$=(0,s.iH)(V),nn=(0,s.iH)(W);return(n,i)=>{const r=(0,a.up)("v-client-table");return(0,a.wg)(),(0,a.iD)("div",p,[(0,a._)("div",D,[(0,a._)("div",y,[(0,a._)("div",null,[(0,a._)("button",{onClick:i[0]||(i[0]=n=>P({domains:!0,tenants:!0,systemUsers:!0}))},"Refresh Tables")])]),(0,a._)("div",g,[(0,a._)("div",v,[w,(0,a._)("button",{onClick:i[1]||(i[1]=n=>async function(){E.showDialog((0,a.RC)((()=>t.e(749).then(t.bind(t,6512)))),{closable:!0,title:"Create Domain",closeCb:async n=>{"component"==n&&await P({domains:!0})}},{})}()),class:"btn-new-item"},"Create New Domain")]),(0,a._)("div",null,[(0,a.Wm)(r,{ref:"table",data:H.value,columns:Y.value,options:K.value},{createdDate:(0,a.w5)((n=>[(0,a._)("span",null,(0,o.toDisplayString)(new Intl.DateTimeFormat("tr-TR",(0,s.SU)(G)).format(new Date(n.row.createDate))),1)])),actions:(0,a.w5)((n=>[(0,a._)("div",null,[(0,a._)("button",{onClick:t=>async function(n,t){await e.execute((async()=>{await R.deleteDomain(n,t),await P({domains:!0,tenants:!0})}),{loading:!0})}(n.row.ID,n.row.name)},"Delete",8,b)])])),_:1},8,["data","columns","options"])])]),(0,a._)("div",I,[(0,a._)("div",f,[T,(0,a._)("button",{onClick:i[2]||(i[2]=n=>async function(){E.showDialog((0,a.RC)((()=>t.e(745).then(t.bind(t,745)))),{closable:!0,title:"Create Tenant",closeCb:async n=>{"component"==n&&await P({tenants:!0})}},{})}())},"Create New Tenant")]),(0,a._)("div",null,[(0,a.Wm)(r,{ref:"table",data:O.value,columns:j.value,options:Q.value},{createdDate:(0,a.w5)((n=>[(0,a._)("span",null,(0,o.toDisplayString)(new Intl.DateTimeFormat("tr-TR",(0,s.SU)(G)).format(new Date(n.row.createDate))),1)])),actions:(0,a.w5)((n=>[(0,a._)("div",null,[(0,a._)("button",{onClick:t=>async function(n,t){await e.execute((async()=>{await R.deleteTenant(n,t),await P({tenants:!0})}),{loading:!0})}(n.row.ID,n.row.name)},"Delete",8,C)])])),_:1},8,["data","columns","options"])])]),(0,a._)("div",h,[(0,a._)("div",U,[A,(0,a._)("button",{onClick:i[3]||(i[3]=n=>async function(){const n=H.value.map((n=>({text:n.name,value:n.ID}))),e=O.value.map((n=>({text:n.name,value:n.ID})));E.showDialog((0,a.RC)((()=>t.e(801).then(t.bind(t,4801)))),{closable:!0,title:"Attach Domain To Tenant",closeCb:async n=>{"component"==n&&await P({domains:!0,tenants:!0})}},{domainOptions:n,tenantOptions:e})}())},"Add New Relation")]),(0,a._)("div",null,[(0,a.Wm)(r,{ref:"table",data:L.value,columns:X.value,options:$.value},{actions:(0,a.w5)((n=>[(0,a._)("div",null,[(0,a._)("button",{onClick:t=>async function(n,t,a,o){await e.execute((async()=>{await R.detachDomainFromTenant(n,t,a,o),await P({tenants:!0})}),{loading:!0})}(n.row.domainID,n.row.tenantID,n.row.domainName,n.row.tenantName)},"Remove",8,N)])])),_:1},8,["data","columns","options"])])]),(0,a._)("div",k,[(0,a._)("div",x,[B,(0,a._)("button",{onClick:i[4]||(i[4]=n=>async function(){E.showDialog((0,a.RC)((()=>t.e(14).then(t.bind(t,3014)))),{closable:!0,title:"Create New System User",closeCb:async n=>{"component"==n&&await P({systemUsers:!0})}},{})}())},"Create System User")]),(0,a._)("div",null,[(0,a.Wm)(r,{ref:"table",data:M.value,columns:J.value,options:nn.value},{actions:(0,a.w5)((n=>[(0,a._)("div",null,[(0,a._)("button",{onClick:t=>async function(n,t){await e.execute((async()=>{await R.deleteSystemUser(n,t),await P({systemUsers:!0})}),{loading:!0})}(n.row.ID,n.row.userName)},"Delete",8,_)])])),_:1},8,["data","columns","options"])])])])])}}});var S=t(5701),E=t.n(S),H=t(8236),O=t.n(H),L=t(6080),M=t.n(L),P=t(6850),z=t.n(P),F=t(7182),Z=t.n(F),q=t(9213),V=t.n(q),W=t(5451),G={};G.styleTagTransform=V(),G.setAttributes=z(),G.insert=M().bind(null,"head"),G.domAPI=O(),G.insertStyleElement=Z(),E()(W.Z,G),W.Z&&W.Z.locals&&W.Z.locals;const Y=(0,t(1419).Z)(R,[["__scopeId","data-v-8dd3748a"]])}}]);
//# sourceMappingURL=539.js.map